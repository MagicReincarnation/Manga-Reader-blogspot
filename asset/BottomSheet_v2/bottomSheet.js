/*!
 * Project: Libary BottomSheet
 * Author: Hirutshuji
 * Patner: Roka
 * Website: https://datakodehiru.blogspot.com
 * Github Repo: ? 
 * Description: Libary BottomSheet flexsibel
 * Version: 2.0.0
 * License: MIT
 * 
 * Created: 2025-01-01
 * Last Updated: 2025-01-01
 * 
 * Copyright (c) 2025 Hirutshuji & Roka
 * All rights reserved.
 */
 class BottomSheet{constructor(t={}){let s={el:null,title:"",content:"",height:"100%",minHeight:0,dragEnabled:!0,backdrop:!0,closeOnBackdrop:!0,rounded:"20px",animation:{duration:100,easing:"ease"},callbacks:{}};this.options=Object.assign({},s,t),this._calculateHeights(),this.currentTranslateY=this.snapCollapsed,this.state="collapsed",this._createElements(),this._bindHandlers(),this._addEventListeners(),this._onResize=this._handleResize.bind(this),window.addEventListener("resize",this._onResize)}_calculateHeights(){let t=window.innerHeight;"string"==typeof this.options.height&&this.options.height.endsWith("%")?this.maxHeight=t*(parseFloat(this.options.height)/100):this.maxHeight=parseFloat(this.options.height),"string"==typeof this.options.minHeight&&this.options.minHeight.endsWith("%")?this.minHeight=t*(parseFloat(this.options.minHeight)/100):this.minHeight=parseFloat(this.options.minHeight),this.snapCollapsed=this.maxHeight-this.minHeight,this.snapFull=0,this.snapHalf=this.maxHeight-(this.maxHeight+this.minHeight)/2}_createElements(){if(this.options.backdrop){let t=`<div class="bottom-sheet-backdrop" style="transition: opacity ${this.options.animation.duration}ms ${this.options.animation.easing};"></div>`,s=document.createElement("div");s.innerHTML=t,this.backdropEl=s.firstElementChild,document.body.appendChild(this.backdropEl)}if(this.options.el)this.sheetEl="string"==typeof this.options.el?document.querySelector(this.options.el):this.options.el;else{let e=`
            <div class="bottom-sheet">
              <div class="head_sheet">
              <h3>${this.options.title}</h3>
              </div>
              <div class="bottom-sheet-content">
                ${this.options.content}
              </div>
            </div>
          `,i=document.createElement("div");i.innerHTML=e,this.sheetEl=i.firstElementChild,document.body.appendChild(this.sheetEl)}this.contentEl=this.sheetEl.querySelector(".bottom-sheet-content"),this._stylesheet()}_stylesheet(){if(this.sheetEl){Object.assign(this.sheetEl.style,{position:"fixed",left:"0",right:"0",bottom:"0",backgroundColor:"var(--main-bg, #1a1a1a)",color:"var(--text-color, #ffffff)",maxWidth:"100%",margin:"0 auto",boxShadow:"var(--box-shadow, 0 4px 6px rgba(0, 0, 0, 0.1))",borderTopLeftRadius:this.options.rounded,borderTopRightRadius:this.options.rounded,height:`${this.maxHeight}px`,transform:`translateY(${this.currentTranslateY}px)`,transition:`transform ${this.options.animation.duration}ms ${this.options.animation.easing}`,zIndex:"1000"});let t=this.sheetEl.querySelector(".bottom-sheet-content");t&&Object.assign(t.style,{height:"100vw",overflowY:"auto",padding:"var(--main-padding, 20px)"})}this.options.backdrop&&this.backdropEl&&Object.assign(this.backdropEl.style,{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",backgroundColor:"rgba(0, 0, 0, 0.5)",transition:`opacity ${this.options.animation.duration}ms ${this.options.animation.easing}`,zIndex:"999",pointerEvents:"none",opacity:"0"})}_bindHandlers(){this._onDrag=this._handleDragMove.bind(this),this._endDrag=this._handleDragEnd.bind(this),this._onBackdropClick=this._handleBackdropClick.bind(this),this._startDrag=this._handleDragStart.bind(this)}_addEventListeners(){this.options.dragEnabled&&(this.sheetEl.addEventListener("touchstart",this._startDrag),this.sheetEl.addEventListener("mousedown",this._startDrag)),this.options.backdrop&&this.options.closeOnBackdrop&&this.backdropEl.addEventListener("click",this._onBackdropClick)}_removeEventListeners(){this.options.dragEnabled&&(this.sheetEl.removeEventListener("touchstart",this._startDrag),this.sheetEl.removeEventListener("mousedown",this._startDrag),document.removeEventListener("touchmove",this._onDrag),document.removeEventListener("mousemove",this._onDrag),document.removeEventListener("touchend",this._endDrag),document.removeEventListener("mouseup",this._endDrag)),this.options.backdrop&&this.options.closeOnBackdrop&&this.backdropEl.removeEventListener("click",this._onBackdropClick),window.removeEventListener("resize",this._onResize)}_handleDragStart(t){this.startY=t.touches?t.touches[0].clientY:t.clientY,this.startTranslateY=this.currentTranslateY,this.lastY=this.startY,this.lastTime=Date.now(),this.startInContent=this.contentEl.contains(t.target),this.isDragging=!1,"touchstart"===t.type?(document.addEventListener("touchmove",this._onDrag,{passive:!1}),document.addEventListener("touchend",this._endDrag)):(document.addEventListener("mousemove",this._onDrag),document.addEventListener("mouseup",this._endDrag))}_handleDragMove(t){let s=t.touches?t.touches[0].clientY:t.clientY,e=s-this.startY;if(!this.isDragging&&this.startInContent){if(!(this.contentEl.scrollTop<=0)||!(e>10))return;this.isDragging=!0,t.preventDefault(),this.startTranslateY=this.currentTranslateY}if(this.isDragging||!this.startInContent){t.preventDefault();let i=this.startTranslateY+e;i=Math.max(0,Math.min(i,this.snapCollapsed)),this.currentTranslateY=i,window.requestAnimationFrame(()=>{this.sheetEl.style.transform=`translate3d(0, ${this.currentTranslateY}px, 0)`}),this.options.callbacks.onDrag&&this.options.callbacks.onDrag(this.getState()),this.lastY=s,this.lastTime=Date.now()}}_handleDragEnd(t){if(!this.isDragging&&this.startInContent){document.removeEventListener("touchmove",this._onDrag),document.removeEventListener("mousemove",this._onDrag),document.removeEventListener("touchend",this._endDrag),document.removeEventListener("mouseup",this._endDrag);return}document.removeEventListener("touchmove",this._onDrag),document.removeEventListener("mousemove",this._onDrag),document.removeEventListener("touchend",this._endDrag),document.removeEventListener("mouseup",this._endDrag);let s=Date.now(),e=t.changedTouches?t.changedTouches[0].clientY:t.clientY,i=(e-this.lastY)/(s-this.lastTime||1),n;if(i<-.3)this.currentTranslateY<=this.snapHalf?(n=this.snapFull,this.state="full"):(n=this.snapHalf,this.state="half");else if(i>.3)this.currentTranslateY>=this.snapHalf?(n=this.snapCollapsed,this.state="collapsed"):(n=this.snapHalf,this.state="half");else{let a=[{state:"full",value:Math.abs(this.currentTranslateY-this.snapFull),snap:this.snapFull},{state:"half",value:Math.abs(this.currentTranslateY-this.snapHalf),snap:this.snapHalf},{state:"collapsed",value:Math.abs(this.currentTranslateY-this.snapCollapsed),snap:this.snapCollapsed}];a.sort((t,s)=>t.value-s.value),n=a[0].snap,this.state=a[0].state}this._animateTo(n)}_animateTo(t){this.sheetEl.style.transition=`transform ${this.options.animation.duration}ms ${this.options.animation.easing}`,this.currentTranslateY=t,this.sheetEl.style.transform=`translateY(${this.currentTranslateY}px)`,this.options.backdrop&&(t===this.snapFull?(this.backdropEl.style.pointerEvents="auto",this.backdropEl.style.opacity="1"):t===this.snapHalf?(this.backdropEl.style.pointerEvents="auto",this.backdropEl.style.opacity="0.5"):(this.backdropEl.style.opacity="0",setTimeout(()=>{this.currentTranslateY!==this.snapFull&&this.currentTranslateY!==this.snapHalf&&(document.body.style.overflow="",this.backdropEl.style.pointerEvents="none")},this.options.animation.duration))),"full"===this.state&&this.options.callbacks.onOpen&&this.options.callbacks.onOpen(),"collapsed"===this.state&&this.options.callbacks.onClose&&this.options.callbacks.onClose()}_handleBackdropClick(){this.close()}_handleResize(){this._calculateHeights(),this.sheetEl.style.height=`${this.maxHeight}px`,"full"===this.state?this.currentTranslateY=this.snapFull:"half"===this.state?this.currentTranslateY=this.snapHalf:this.currentTranslateY=this.snapCollapsed,this.sheetEl.style.transform=`translateY(${this.currentTranslateY}px)`}open(){this.state="full",this._animateTo(this.snapFull),document.body.style.overflow="hidden"}close(){this.state="collapsed",document.body.style.overflow="",this._animateTo(this.snapCollapsed)}toggle(){"full"===this.state?this.close():this.open()}updateContent(t){this.contentEl&&(this.contentEl.innerHTML=t)}getState(){let t=this.maxHeight-this.currentTranslateY;return{state:this.state,visibleHeight:t,maxHeight:this.maxHeight,minHeight:this.minHeight}}destroy(){this._removeEventListeners(),!this.options.el&&this.sheetEl.parentNode&&this.sheetEl.parentNode.removeChild(this.sheetEl),this.backdropEl&&this.backdropEl.parentNode&&this.backdropEl.parentNode.removeChild(this.backdropEl)}}